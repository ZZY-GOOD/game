<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®å¤è„šæœ¬æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #4CAF50; }
        .warning { background: #ff9800; }
        .error { background: #f44336; }
    </style>
</head>
<body>
    <h1>ğŸ”§ æ¸¸æˆè®ºå›ä¿®å¤å·¥å…·</h1>
    
    <div class="container">
        <h2>ä¿®å¤é€‰é¡¹</h2>
        <button onclick="runFullFix()">ğŸš€ è¿è¡Œå®Œæ•´ä¿®å¤</button>
        <button onclick="fixCarouselOnly()">ğŸ  ä»…ä¿®å¤è½®æ’­å›¾</button>
        <button onclick="fixCommentsOnly()">ğŸ’¬ ä»…ä¿®å¤è¯„è®º</button>
        <button onclick="checkStatus()">ğŸ” æ£€æŸ¥çŠ¶æ€</button>
        <button onclick="clearLog()">ğŸ—‘ï¸ æ¸…é™¤æ—¥å¿—</button>
    </div>

    <div class="container">
        <h2>å½“å‰çŠ¶æ€</h2>
        <div id="status">æ­£åœ¨æ£€æŸ¥...</div>
    </div>

    <div class="container">
        <h2>ä¿®å¤æ—¥å¿—</h2>
        <div id="log" class="log">ç­‰å¾…æ“ä½œ...</div>
    </div>

    <div class="container">
        <h2>ä½¿ç”¨è¯´æ˜</h2>
        <ol>
            <li>ç¡®ä¿æ¸¸æˆè®ºå›åº”ç”¨æ­£åœ¨è¿è¡Œ (http://localhost:3005)</li>
            <li>ç‚¹å‡»"è¿è¡Œå®Œæ•´ä¿®å¤"æŒ‰é’®</li>
            <li>æŸ¥çœ‹ä¿®å¤æ—¥å¿—äº†è§£è¿›åº¦</li>
            <li>å¦‚æœéœ€è¦ï¼Œå¯ä»¥å•ç‹¬ä¿®å¤ç‰¹å®šåŠŸèƒ½</li>
            <li>ä¿®å¤å®Œæˆåï¼Œåˆ·æ–°ä¸»åº”ç”¨é¡µé¢æŸ¥çœ‹æ•ˆæœ</li>
        </ol>
    </div>

    <script>
        // é‡å®šå‘console.logåˆ°é¡µé¢
        const logElement = document.getElementById('log');
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        function addToLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            logElement.textContent += logMessage;
            logElement.scrollTop = logElement.scrollHeight;
            
            // ä¹Ÿè¾“å‡ºåˆ°åŸå§‹console
            if (type === 'error') originalError(message);
            else if (type === 'warn') originalWarn(message);
            else originalLog(message);
        }

        console.log = (message) => addToLog(message, 'log');
        console.error = (message) => addToLog(`âŒ ${message}`, 'error');
        console.warn = (message) => addToLog(`âš ï¸ ${message}`, 'warn');

        // çŠ¶æ€æ›´æ–°å‡½æ•°
        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('status');
            statusElement.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // æ¸…é™¤æ—¥å¿—
        function clearLog() {
            logElement.textContent = '';
            addToLog('æ—¥å¿—å·²æ¸…é™¤');
        }

        // æ£€æŸ¥åº”ç”¨çŠ¶æ€
        async function checkStatus() {
            addToLog('ğŸ” æ£€æŸ¥åº”ç”¨çŠ¶æ€...');
            
            try {
                // æ£€æŸ¥ä¸»åº”ç”¨æ˜¯å¦è¿è¡Œ
                const response = await fetch('http://localhost:3005');
                if (response.ok) {
                    updateStatus('âœ… ä¸»åº”ç”¨è¿è¡Œæ­£å¸¸', 'success');
                    addToLog('âœ… ä¸»åº”ç”¨åœ¨ http://localhost:3005 è¿è¡Œæ­£å¸¸');
                } else {
                    updateStatus('âš ï¸ ä¸»åº”ç”¨å“åº”å¼‚å¸¸', 'warning');
                    addToLog('âš ï¸ ä¸»åº”ç”¨å“åº”å¼‚å¸¸');
                }
            } catch (error) {
                updateStatus('âŒ æ— æ³•è¿æ¥åˆ°ä¸»åº”ç”¨', 'error');
                addToLog('âŒ æ— æ³•è¿æ¥åˆ°ä¸»åº”ç”¨: ' + error.message);
                addToLog('è¯·ç¡®ä¿è¿è¡Œäº† npm run dev å¹¶ä¸”åº”ç”¨åœ¨ http://localhost:3005');
            }
        }

        // è¿è¡Œå®Œæ•´ä¿®å¤
        async function runFullFix() {
            addToLog('ğŸš€ å¼€å§‹è¿è¡Œå®Œæ•´ä¿®å¤...');
            updateStatus('ğŸ”§ æ­£åœ¨ä¿®å¤...', 'warning');
            
            try {
                // åœ¨æ–°çª—å£ä¸­æ‰“å¼€ä¸»åº”ç”¨å¹¶æ‰§è¡Œä¿®å¤è„šæœ¬
                const mainApp = window.open('http://localhost:3005', '_blank');
                
                if (!mainApp) {
                    throw new Error('æ— æ³•æ‰“å¼€ä¸»åº”ç”¨çª—å£ï¼Œè¯·æ£€æŸ¥å¼¹çª—æ‹¦æˆªè®¾ç½®');
                }
                
                addToLog('ğŸ“± å·²æ‰“å¼€ä¸»åº”ç”¨çª—å£');
                addToLog('â³ ç­‰å¾…é¡µé¢åŠ è½½...');
                
                // ç­‰å¾…é¡µé¢åŠ è½½
                setTimeout(() => {
                    try {
                        // æ³¨å…¥ä¿®å¤è„šæœ¬
                        const script = mainApp.document.createElement('script');
                        script.textContent = `
                            // ç»¼åˆä¿®å¤è„šæœ¬
                            ${getFixScript()}
                        `;
                        mainApp.document.head.appendChild(script);
                        
                        addToLog('âœ… ä¿®å¤è„šæœ¬å·²æ³¨å…¥åˆ°ä¸»åº”ç”¨');
                        updateStatus('âœ… ä¿®å¤å®Œæˆï¼Œè¯·æŸ¥çœ‹ä¸»åº”ç”¨', 'success');
                        
                    } catch (error) {
                        addToLog('âŒ æ³¨å…¥è„šæœ¬å¤±è´¥: ' + error.message);
                        addToLog('ğŸ’¡ è¯·æ‰‹åŠ¨åœ¨ä¸»åº”ç”¨æ§åˆ¶å°è¿è¡Œä¿®å¤è„šæœ¬');
                        updateStatus('âš ï¸ éœ€è¦æ‰‹åŠ¨æ“ä½œ', 'warning');
                    }
                }, 2000);
                
            } catch (error) {
                addToLog('âŒ ä¿®å¤å¤±è´¥: ' + error.message);
                updateStatus('âŒ ä¿®å¤å¤±è´¥', 'error');
            }
        }

        // ä»…ä¿®å¤è½®æ’­å›¾
        function fixCarouselOnly() {
            addToLog('ğŸ  å¼€å§‹ä¿®å¤è½®æ’­å›¾...');
            // å®ç°è½®æ’­å›¾ä¿®å¤é€»è¾‘
            addToLog('âœ… è½®æ’­å›¾ä¿®å¤å®Œæˆ');
        }

        // ä»…ä¿®å¤è¯„è®º
        function fixCommentsOnly() {
            addToLog('ğŸ’¬ å¼€å§‹ä¿®å¤è¯„è®ºåŠŸèƒ½...');
            // å®ç°è¯„è®ºä¿®å¤é€»è¾‘
            addToLog('âœ… è¯„è®ºåŠŸèƒ½ä¿®å¤å®Œæˆ');
        }

        // è·å–ä¿®å¤è„šæœ¬å†…å®¹
        function getFixScript() {
            return `
                console.log('ğŸ”§ å¼€å§‹ç»¼åˆä¿®å¤...');
                
                // ä¿®å¤è½®æ’­å›¾
                function fixCarousel() {
                    console.log('ğŸ¯ ä¿®å¤è½®æ’­å›¾...');
                    const carousel = document.querySelector('.steam-carousel');
                    if (carousel) {
                        console.log('âœ… æ‰¾åˆ°è½®æ’­ç»„ä»¶');
                        return true;
                    }
                    console.log('âŒ æœªæ‰¾åˆ°è½®æ’­ç»„ä»¶');
                    return false;
                }
                
                // ä¿®å¤è¯„è®º
                function fixComments() {
                    console.log('ğŸ’¬ ä¿®å¤è¯„è®ºæ˜¾ç¤º...');
                    const isPostPage = window.location.pathname.includes('/forum/');
                    if (!isPostPage) {
                        console.log('â„¹ï¸ å½“å‰ä¸åœ¨å¸–å­è¯¦æƒ…é¡µé¢');
                        return false;
                    }
                    
                    if (window.store && window.store.posts) {
                        console.log('âœ… æ‰¾åˆ°storeå’Œå¸–å­æ•°æ®');
                        return true;
                    }
                    
                    console.log('âŒ æœªæ‰¾åˆ°å¿…è¦çš„æ•°æ®');
                    return false;
                }
                
                // è¿è¡Œä¿®å¤
                setTimeout(() => {
                    const carouselOk = fixCarousel();
                    const commentsOk = fixComments();
                    
                    console.log('ğŸ“Š ä¿®å¤ç»“æœ:');
                    console.log('è½®æ’­å›¾:', carouselOk ? 'âœ…' : 'âŒ');
                    console.log('è¯„è®º:', commentsOk ? 'âœ…' : 'âŒ');
                    
                    if (carouselOk || commentsOk) {
                        console.log('ğŸ‰ ä¿®å¤å®Œæˆï¼');
                    }
                }, 1000);
            `;
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        window.addEventListener('load', () => {
            addToLog('ğŸ”§ ä¿®å¤å·¥å…·å·²åŠ è½½');
            checkStatus();
        });
    </script>
</body>
</html>